# Apache configuration for arturmorin.page
# Place this file in /etc/apache2/sites-available/arturmorin.page.conf
# Enable with: sudo a2ensite arturmorin.page.conf

<VirtualHost *:80>
    ServerName arturmorin.page
    ServerAlias www.arturmorin.page
    
    # Redirect HTTP to HTTPS
    Redirect permanent / https://arturmorin.page/
    
    # Let's Encrypt challenge
    DocumentRoot /var/www/html
    <Directory /var/www/html>
        AllowOverride None
    </Directory>
</VirtualHost>

<VirtualHost *:443>
    ServerName arturmorin.page
    ServerAlias www.arturmorin.page
    
    # SSL Configuration (will be updated by certbot)
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/arturmorin.page/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/arturmorin.page/privkey.pem
    
    # Modern SSL configuration
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305
    SSLHonorCipherOrder off
    SSLSessionTickets off
    
    # Document root - update this to your actual site directory
    DocumentRoot /var/www/arturmorin.page
    
    <Directory /var/www/arturmorin.page>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Rewrite rules
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /photography-index.html [L]
    </Directory>
    
    # Security headers
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://www.google.com https://www.gstatic.com https://cdn-cookieyes.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://www.google-analytics.com https://*.google-analytics.com https://www.googletagmanager.com https://www.google.com https://www.recaptcha.net https://cdn-cookieyes.com https://log.cookieyes.com; frame-src 'self' https://www.google.com https://www.recaptcha.net; object-src 'none'; base-uri 'self'; form-action 'self' mailto:; upgrade-insecure-requests;"
    
    # Cache static assets
    <LocationMatch "\.(jpg|jpeg|png|gif|ico|css|js|svg|webp|woff|woff2|ttf|eot)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </LocationMatch>
    
    # Don't cache HTML
    <LocationMatch "\.html$">
        Header set Cache-Control "public, max-age=0, must-revalidate"
    </LocationMatch>
    
    # Gzip compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json image/svg+xml
    </IfModule>
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/arturmorin.page_error.log
    CustomLog ${APACHE_LOG_DIR}/arturmorin.page_access.log combined
</VirtualHost>

